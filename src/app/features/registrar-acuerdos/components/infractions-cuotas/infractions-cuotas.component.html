<div class="infractions-cuotas-wrapper">
    <div class="container2">
        <div class="title-container">
            <div class="icon-number">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="icon icon-tabler icons-tabler-outline icon-tabler-number-5">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M8 20h4a4 4 0 1 0 0 -8h-4v-8h8" />
                </svg>
            </div>
            <div class="title">Infracciones Pendientes</div>
        </div>

        <!-- Violations Table -->
        <div class="table-container">
            <table class="violations-table">
                <thead>
                    <tr>
                        <th class="checkbox-column">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" [checked]="allInfractionsSelected"
                                    (change)="toggleAllInfractions($event)" [disabled]="infractions.length === 0" />
                            </div>
                        </th>
                        <th>Nº Comparendo</th>
                        <th>Fecha</th>
                        <th>Valor</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Empty State -->
                    <tr *ngIf="infractions.length === 0" class="empty-state">
                        <td colspan="6">No se ha encontrado ningún infractor aún</td>
                    </tr>

                    <!-- Data Rows -->
                    <tr *ngFor="let infraction of infractions">
                        <td class="checkbox-column">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" [(ngModel)]="infraction.selected" />
                            </div>
                        </td>
                        <td>{{ infraction.numeroComparendo }}</td>
                        <td>{{ infraction.fecha }}</td>
                        <td>{{ formatCurrency(infraction.valor) }}</td>
                        <td><span class="status-badge status-pending">{{ infraction.estado }}</span></td>
                        <td>
                            <button class="btn-view" (click)="viewInfractionDetails(infraction)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
                                    <path
                                        d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" />
                                </svg>
                                Ver
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="container2">
        <div class="title-container">
            <div class="icon-number">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="icon icon-tabler icons-tabler-outline icon-tabler-number-6">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M8 16a4 4 0 1 0 8 0v-1a4 4 0 1 0 -8 0" />
                    <path d="M16 8a4 4 0 1 0 -8 0v8" />
                </svg>
            </div>
            <div class="title">Asignación de Cuotas</div>
        </div>

        <div class="installments-form">
            <div class="item-input">
                <label class="label">Total a pagar</label>
                <div class="input-text2">
                    <div class="valor-readonly">{{ formatCurrency(totalAPagar) }}</div>
                </div>
            </div>

            <div class="group-item-input2">
                <div class="item-input2">
                    <label class="label">Número de cuotas</label>
                    <div class="select-wrapper">
                        <select class="input-field" [(ngModel)]="numeroCuotas">
                            <option [value]="null">Selecciona</option>
                            <option [value]="3">3 cuotas</option>
                            <option [value]="6">6 cuotas</option>
                            <option [value]="12">12 cuotas</option>
                            <option [value]="18">18 cuotas</option>
                            <option [value]="24">24 cuotas</option>
                        </select>
                        <div class="icon-dropdown">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M6 9l6 6l6 -6" />
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="item-input2">
                    <label class="label">Fecha inicial</label>
                    <input type="date" class="input-field" [(ngModel)]="fechaInicial" />
                </div>

                <div class="item-input2">
                    <label class="label">Tipo de interés</label>
                    <div class="select-wrapper">
                        <select class="input-field" [(ngModel)]="tipoInteres">
                            <option value="">Selecciona</option>
                            <option value="1.0">1.0% Mensual</option>
                            <option value="1.5">1.5% Mensual</option>
                            <option value="2.0">2.0% Mensual</option>
                        </select>
                        <div class="icon-dropdown">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M6 9l6 6l6 -6" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button class="button-generate" [disabled]="!canGenerateInstallments" (click)="generateInstallments()">
            <div class="label2">Generar Cuotas</div>
        </button>

        <!-- Installments Table - Only shown after generation -->
        <div *ngIf="installmentsGenerated" class="table-container">
            <table class="installments-table">
                <thead>
                    <tr>
                        <th>Nº Cuota</th>
                        <th>Fecha de vencimiento</th>
                        <th>Valor</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let installment of installments">
                        <td>{{ installment.numero }}</td>
                        <td>{{ installment.fechaVencimiento }}</td>
                        <td>{{ formatCurrency(installment.valor) }}</td>
                        <td><span class="status-badge status-scheduled">{{ installment.estado }}</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Infraction Details Modal -->
<div class="modal-overlay" *ngIf="showInfractionModal" (click)="closeInfractionModal()">
    <div class="modal-infracciones" (click)="$event.stopPropagation()" *ngIf="selectedInfraction">
        <div class="frame-427319133">
            <div class="detalles-de-la-infracci-n">Detalles de la infracción</div>
            <button class="btn-close-modal" (click)="closeInfractionModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M18 6l-12 12"/>
                    <path d="M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="frame-427319151">
            <div class="frame-427319124">
                <div class="n-mero-de-comparendo">Número de comparendo</div>
                <div class="modal-value">{{ selectedInfraction.numeroComparendo }}</div>
            </div>
            <div class="frame-427319125">
                <div class="fecha-de-infracci-n">Fecha de infracción</div>
                <div class="modal-value">{{ selectedInfraction.fecha }}</div>
            </div>
        </div>
        <div class="frame-427319152">
            <div class="frame-427319126">
                <div class="c-digo">Código</div>
                <div class="modal-value">{{ selectedInfraction.codigo }}</div>
            </div>
            <div class="frame-427319127">
                <div class="placa">Placa</div>
                <div class="modal-value">{{ selectedInfraction.placa }}</div>
            </div>
        </div>
        <div class="frame-427319150">
            <div class="frame-427319128">
                <div class="n-mero-de-resoluci-n">Número de resolución</div>
                <div class="modal-value">{{ selectedInfraction.numeroResolucion }}</div>
            </div>
            <div class="frame-427319129">
                <div class="fecha-de-resoluci-n">Fecha de resolución</div>
                <div class="modal-value">{{ selectedInfraction.fechaResolucion }}</div>
            </div>
        </div>
        <div class="frame-427319153">
            <div class="frame-427319131">
                <div class="inter-s-mora">Interés (mora)</div>
                <div class="modal-value">{{ selectedInfraction.interesMora }}</div>
            </div>
            <div class="frame-427319132">
                <div class="estado">Estado</div>
                <div class="modal-value">{{ selectedInfraction.estado }}</div>
            </div>
        </div>
        <div class="frame-427319130">
            <div class="valor">Valor</div>
            <div class="modal-value-total">{{ formatCurrency(selectedInfraction.valor) }}</div>
        </div>
    </div>
</div>